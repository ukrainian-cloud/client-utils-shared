{"version":3,"sources":["../src/index.ts","../src/helpers/name.ts","../src/@utility.ts","../src/@initializable.ts","../src/utils/local-db.ts","../src/utils/color-scheme.ts","../src/helpers/component.ts"],"sourcesContent":["export * from './@utility';\nexport * from './utils/local-db';\nexport * from './utils/color-scheme';\nexport * from './helpers/component';\nexport * from './helpers/name';\n","export function Name(name: string) {\n\treturn <T>(Class: T, _context: ClassDecoratorContext) => {\n\t\tObject.defineProperty(Class, 'name', {\n\t\t\tvalue: name,\n\t\t});\n\t};\n}\n\nexport function withName<T extends Function>(name: string, func: T) {\n\tObject.defineProperty(func, 'name', {\n\t\tvalue: name,\n\t});\n\treturn func;\n}\n","import { Initializable } from './@initializable';\nimport { withName } from './helpers/name';\n\nconst globalStorageName = '__uc_globals';\n\nif (!(globalThis as any)[globalStorageName]) {\n\tObject.defineProperty(globalThis, globalStorageName, {\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t\twritable: false,\n\t\tvalue: Object.create(null),\n\t});\n}\n\nfunction getGlobal<T>(name: string, factory: () => T): T {\n\tconst storage = (globalThis as any)[globalStorageName];\n\tif (name in storage) return storage[name];\n\treturn storage[name] = factory();\n}\n\nconst utility = getGlobal('utility', () => Symbol());\n\nconst utilityStore = getGlobal('utilityStore', () => new WeakMap<any, any>());\n\nconst utilityState = getGlobal('utilityState', () => ({ isLoaded: false }));\n\ninterface Utility<T extends Initializable, U extends Initializable> {\n\timplements: abstract new (...args: any[]) => T;\n\timplementation: new (...args: any[]) => U;\n}\n\nexport const isUtility = withName(\n\t'isUtility',\n\t(obj: any): obj is Utility<Initializable, Initializable> => Boolean(obj?.[utility]),\n);\n\nexport const createUtility = withName(\n\t'createUtility',\n\t<T extends Initializable, U extends Initializable>(\n\t\timplementsClass: abstract new (...args: any[]) => T,\n\t\timplementationClass: new (...args: any[]) => U,\n\t) => ({\n\t\t[utility]: true,\n\t\timplements: implementsClass,\n\t\timplementation: implementationClass,\n\t} as Utility<T, U>),\n);\n\nexport const loadUtilities = withName(\n\t'loadUtilities',\n\tasync (...utilities: Utility<Initializable, Initializable>[]) => {\n\t\tconst promises: Promise<Initializable>[] = [];\n\t\tfor (const utility of utilities) {\n\t\t\tconst util = new utility.implementation();\n\t\t\tconst promise = util.init().then(() => {\n\t\t\t\tutilityStore.set(utility.implements, util);\n\t\t\t\treturn util;\n\t\t\t});\n\t\t\tpromises.push(promise);\n\t\t\tutilityStore.set(utility.implements, promise);\n\t\t}\n\t\tawait Promise.all(promises);\n\t\tutilityState.isLoaded = true;\n\t},\n);\n\nexport const getUtility = withName(\n\t'getUtility',\n\t<T>(target: abstract new (...args: any[]) => T) => Promise.resolve<T>(utilityStore.get(target)),\n);\n\nexport const useUtil = withName(\n\t'useUtil',\n\t<T>(target: abstract new (...args: any[]) => T): T => {\n\t\tif (!utilityState.isLoaded) throw new Error(\"Can't call useUtil hook before utilities fully loaded\");\n\t\treturn utilityStore.get(target);\n\t},\n);\n","import { Name } from \"./helpers/name\";\n\n@Name('Initializable')\nexport abstract class Initializable {\n\tabstract init(): Promise<void>;\n}\n","import { Initializable } from \"../@initializable\";\nimport { Name } from \"../helpers/name\";\n\nenum Theme {\n\tdark = \"dark\",\n\tlight = \"light\",\n}\n\ninterface Mappings {\n\ttheme: Theme;\n}\n\nconst enums = {\n\tTheme,\n};\n\nexport type LocalDBEnum<T extends keyof typeof enums> = LocalDB['enums'][T][keyof LocalDB['enums'][T]];\n\n@Name('LocalDB')\nexport abstract class LocalDB extends Initializable {\n\tprivate changeListeners: Record<string, Set<(value: any) => void>> = {};\n\tprivate options: Record<string, WeakMap<(value: any) => void, { once?: boolean }>> = {};\n\n\tenums = enums;\n\n\tabstract get<T extends keyof Mappings>(name: T): Promise<Mappings[T]>;\n\n\tabstract set<T extends keyof Mappings>(name: T, value: Mappings[T]): Promise<void>;\n\n\tabstract delete<T extends keyof Mappings>(name: T): Promise<void>;\n\n\tprotected emitChange(name: string, value: any) {\n\t\tif (!this.changeListeners[name]) return;\n\t\tthis.changeListeners[name].forEach((callback) => {\n\t\t\tconst { once } = this.options[name].get(callback)!;\n\t\t\tif (once) {\n\t\t\t\tthis.changeListeners[name].delete(callback);\n\t\t\t\tthis.options[name].delete(callback);\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tcallback(value);\n\t\t\t} catch(e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tonChange<T extends keyof Mappings>(name: T, callback: (value: Mappings[T]) => void, options?: { once?: boolean }) {\n\t\tthis.changeListeners[name] ??= new Set();\n\t\tthis.options[name] ??= new WeakMap();\n\t\tthis.changeListeners[name].add(callback);\n\t\tthis.options[name].set(callback, options || {});\n\t};\n\n\toffChange<T extends keyof Mappings>(name: T, callback: (value: Mappings[T]) => void) {\n\t\tif (!this.changeListeners[name]) return;\n\t\tthis.changeListeners[name].delete(callback);\n\t\tthis.options[name].delete(callback);\n\t};\n}\n","import { Initializable } from '../@initializable';\nimport { getUtility } from '../@utility';\nimport { Name } from '../helpers/name';\nimport { LocalDB, LocalDBEnum } from './local-db';\n\n@Name('ColorScheme')\nexport abstract class ColorScheme extends Initializable {\n\tabstract getDefault(): Promise<LocalDBEnum<'Theme'>>;\n\n\tasync init() {\n\t\tconst db = await getUtility(LocalDB);\n\t\ttry {\n\t\t\tawait db.get('theme');\n\t\t} catch(e) {\n\t\t\tawait db.set('theme', await this.getDefault());\n\t\t}\n\t}\n}\n","import type { FunctionalComponent, Component as ClassComponent} from 'preact';\nimport { withName } from './name';\n\ntype UnionToIntersection<U> = (U extends any ? (k: U)=>void : never) extends ((k: infer I)=>void) ? I : never;\n\nfunction Component<Props, Exp extends Record<string, any>[]>(\n\tname: string,\n\tComponent: FunctionalComponent<Props>,\n\t...additionalComponentExports: Exp\n): FunctionalComponent<Props> & UnionToIntersection<Exp[number]>\nfunction Component<Props, Exp extends Record<string, any>[]>(\n\tname: string,\n\tComponent: ClassComponent<Props>,\n\t...additionalComponentExports: Exp\n): ClassComponent<Props> & UnionToIntersection<Exp[number]>\n\n\nfunction Component(name: string, Component: any, ...additionalComponentExports: any[]) {\n\treturn Object.assign(Object.defineProperty(Component, 'name', { value: name }), ...additionalComponentExports);\n}\n\nconst ComponentNamed = withName('Component', Component);\n\nexport { ComponentNamed as Component }\n"],"mappings":"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","names":["utility","Theme","Component"]}